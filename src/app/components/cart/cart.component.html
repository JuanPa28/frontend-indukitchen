<div class="cart-container">
  <!-- T√≠tulo principal -->
  <div class="cart-header">
    <h1 class="cart-title">
      <span class="cart-icon">üõí</span>
      Carrito de Compras
    </h1>
  </div>

  <!-- Contenido del carrito -->
  <div *ngIf="items.length > 0; else emptyCart" class="cart-content">

    <!-- Indicador de carga -->
    <div *ngIf="isLoading" class="loading-indicator">
      <div class="spinner"></div>
      <span>Actualizando carrito...</span>
    </div>

    <!-- Lista de productos -->
    <div class="cart-items" [class.loading]="isLoading">
      <h2 class="section-title">
        Productos Seleccionados
        <span class="item-count">({{ items.length }} item{{ items.length !== 1 ? 's' : '' }})</span>
      </h2>
      <div class="items-list">
        <div *ngFor="let item of items; trackBy: trackByProductId" class="cart-item">
          <!-- Mostrar item del carrito local directamente -->
          <div class="product-card">
            <div class="product-image">
              <img [src]="item.producto.imagen || 'assets/placeholder.png'"
                   [alt]="item.producto.nombre"
                   (error)="handleImageError($event)">
            </div>

            <div class="product-info">
              <h4 class="product-name">{{ item.producto.nombre }}</h4>
              <p class="product-description">{{ item.producto.descripcion }}</p>

              <div class="price-quantity">
                <div class="price">
                  <span class="unit-price">{{ item.producto.precio | currency:'COP':'symbol':'1.0-0' }}</span>
                  <span class="quantity-text">x {{ item.cantidad }}</span>
                </div>
                <div class="subtotal">
                  {{ (item.producto.precio * item.cantidad) | currency:'COP':'symbol':'1.0-0' }}
                </div>
              </div>
            </div>

            <div class="product-actions">
              <div class="quantity-controls">
                <button type="button"
                        class="qty-btn"
                        (click)="updateQuantity(item.idProducto, item.cantidad - 1)"
                        [disabled]="item.cantidad <= 1">
                  -
                </button>
                <span class="quantity">{{ item.cantidad }}</span>
                <button type="button"
                        class="qty-btn"
                        (click)="updateQuantity(item.idProducto, item.cantidad + 1)">
                  +
                </button>
              </div>

              <button type="button"
                      class="remove-btn"
                      (click)="removeProduct(item.idProducto)"
                      title="Eliminar producto">
                üóëÔ∏è
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Resumen del pedido -->
    <div class="order-summary">
      <div class="summary-card">
        <h3 class="summary-title">Resumen del Pedido</h3>
        <div class="total-amount">
          <span class="total-label">Total:</span>
          <span class="total-value">{{ total | currency:'COP':'symbol':'1.0-0' }}</span>
        </div>
        <div class="cart-actions">
          <button class="btn btn-outline" (click)="clearCart()">
            <span class="btn-icon">üóëÔ∏è</span>
            Vaciar carrito
          </button>
        </div>
      </div>
    </div>

    <!-- Formulario de informaci√≥n del cliente -->
    <div class="customer-form">
      <h3 class="form-title">Informaci√≥n del Cliente</h3>
      <form class="client-form" [formGroup]="clientForm" (ngSubmit)="onSubmit()">

        <div class="form-group">
          <label for="cedula" class="form-label">C√©dula *</label>
          <input
            type="text"
            id="cedula"
            class="form-input"
            formControlName="cedula"
            placeholder="Ingresa tu n√∫mero de c√©dula"
            maxlength="10">
          <div *ngIf="clientForm.get('cedula')?.errors?.['required'] && clientForm.get('cedula')?.touched"
               class="error-message">
            La c√©dula es requerida
          </div>
        </div>

        <div class="form-group">
          <label for="nombre" class="form-label">Nombre Completo *</label>
          <input
            type="text"
            id="nombre"
            class="form-input"
            formControlName="nombre"
            placeholder="Ingresa tu nombre completo">
          <div *ngIf="clientForm.get('nombre')?.errors?.['required'] && clientForm.get('nombre')?.touched"
               class="error-message">
            El nombre es requerido
          </div>
        </div>

        <div class="form-group">
          <label for="direccion" class="form-label">Direcci√≥n *</label>
          <textarea
            id="direccion"
            class="form-textarea"
            formControlName="direccion"
            placeholder="Ingresa tu direcci√≥n completa"
            rows="3"></textarea>
          <div *ngIf="clientForm.get('direccion')?.errors?.['required'] && clientForm.get('direccion')?.touched"
               class="error-message">
            La direcci√≥n es requerida
          </div>
        </div>

        <div class="form-group">
          <label for="correo" class="form-label">Correo Electr√≥nico *</label>
          <input
            type="email"
            id="correo"
            class="form-input"
            formControlName="correo"
            placeholder="correo@ejemplo.com">
          <div *ngIf="clientForm.get('correo')?.errors?.['required'] && clientForm.get('correo')?.touched"
               class="error-message">
            El correo es requerido
          </div>
          <div *ngIf="clientForm.get('correo')?.errors?.['email'] && clientForm.get('correo')?.touched"
               class="error-message">
            Ingresa un correo v√°lido
          </div>
        </div>

        <div class="form-group">
          <label for="telefono" class="form-label">Tel√©fono *</label>
          <input
            type="tel"
            id="telefono"
            class="form-input"
            formControlName="telefono"
            placeholder="Ingresa tu n√∫mero de tel√©fono"
            maxlength="10">
          <div *ngIf="clientForm.get('telefono')?.errors?.['required'] && clientForm.get('telefono')?.touched"
               class="error-message">
            El tel√©fono es requerido
          </div>
        </div>

        <div class="form-actions">
          <button
            type="submit"
            class="btn btn-primary"
            [disabled]="!clientForm.valid">
            <span class="btn-icon">‚úÖ</span>
            Finalizar Compra
          </button>
        </div>
      </form>
    </div>

  </div>

  <!-- Estado de carrito vac√≠o -->
  <ng-template #emptyCart>
    <div class="empty-cart">
      <div class="empty-cart-icon">üõí</div>
      <h2 class="empty-cart-title">Tu carrito est√° vac√≠o</h2>
      <p class="empty-cart-text">Agrega algunos productos para comenzar tu compra</p>
    </div>
  </ng-template>
</div>


